{
  "filename": "extend.md",
  "__html": "<h2>扩展点设计</h2>\n<h3>什么是扩展点</h3>\n<p>在电商系统或者大型业务系统中都是按业务域的维度进行划分，比如交易下单系统有很十几个域:交付域，支付域，库存域，仓储域，价格域，配送等域。在应用框架层面，域的信息主要用于分类聚合，在应用系统开发中通过手动加注解的方式统一收集，在运营平台可以统一的管控，从业务域的角度去看哪些功能可以扩展定制，或者对其进行增强。域描述定义的注解可以查看源码org.xujin.halo.annotation.domian.Domain.java。\n每个域都会对外提供一系列的能力，我们一般称之为对外提供的服务。比如库存域提供库存查询，扣减库存等服务。每次交易过程可能跨了N多个域完成，如果我们想知道一次交易参与其中每个域的调用顺序，或者域和域之间的依赖关系，我们也可以通过注解的方式去定义域提供的服务。域服务定义的注解可以查看源码org.xujin.halo.annotation.domian.DomainService.java。\n每个功能域都会对外提供一系列的能力，比如订单域对外提供了订单拆单的能力。而每一个能力往往又是由多个扩展点组成。第一次接触扩展点，可能大家理解起来比较抽象。可以举个例子帮助大家理解，支付域提供了对外支付的能力，而支付方式有银行卡支付，银联支付，苹果支付，以及支付宝支付，微信支付等第三方支付，而支付能力对应的多种支付方式就是扩展点。\n很多应用架构分层不合理，怎么解决呢?用扩展点的设计去解决。什么是扩展点的设计思想?其实设计思想也一直在使用，比如经常使用的策略模式，还有就是简单系统和简单场景编写的if-else代码。因此基于扩展点的设计思想是应用框架必备的设计思想。在Halo框架中扩展点的设计是通过自定义注解的方式去实现，扩展点注解的代码如下所示：</p>\n<pre><code class=\"language-java\"><span class=\"hljs-meta\">@Inherited</span>\n<span class=\"hljs-meta\">@Retention</span>(RetentionPolicy.RUNTIME)\n<span class=\"hljs-meta\">@Documented</span>\n<span class=\"hljs-meta\">@Target</span>({ElementType.TYPE})\n<span class=\"hljs-meta\">@Component</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-meta\">@interface</span> Extension {\n    <span class=\"hljs-comment\">//扩展的Id</span>\n    <span class=\"hljs-function\">String <span class=\"hljs-title\">id</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">default</span> \"\"</span>;\n    <span class=\"hljs-comment\">//对应的扩展点Id</span>\n    <span class=\"hljs-function\">String <span class=\"hljs-title\">extensionPointId</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">default</span> \"\"</span>;\n    <span class=\"hljs-comment\">//扩展对应的描述</span>\n    <span class=\"hljs-function\">String <span class=\"hljs-title\">desc</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">default</span> \"\"</span>;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">defaultExtension</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">false</span></span>;\n\n    <span class=\"hljs-comment\">//一级业务code</span>\n    <span class=\"hljs-function\">String <span class=\"hljs-title\">bizCode</span><span class=\"hljs-params\">()</span>  <span class=\"hljs-keyword\">default</span> CoreConstant.DEFAULT_BIZ_CODE</span>;\n    <span class=\"hljs-comment\">//可扩展业务code，属于预留，并不是每个系统都有</span>\n    <span class=\"hljs-function\">String <span class=\"hljs-title\">extBizCode</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">default</span> CoreConstant.DEFAULT_EXT_BIZ_CODE</span>;\n}\n</code></pre>\n"
}